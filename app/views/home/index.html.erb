<%= content_for :top_right do %>
  <div class="player-config" data-selector="player">
    <%= form_tag player_name_path do %>
      <%= label_tag :name, "Player name" %>
      <%= text_field_tag :name, player_name %>
      <%= submit_tag "Update" %>
    <% end %>
  </div>
<% end %>

<div class="row"}>
  <h3>Games</h3>

  <table class="u-full-width">
    <thead>
    <tr>
      <th>Game</th>
      <th>State</th>
      <th>Players</th>
      <th>Sprint</th>
    </tr>
    </thead>
    <tbody>
    <% Game.order(updated_at: :desc).each do |game| %>
      <tr onclick="window.location='<%= game_path(game) %>';" title="Config: <%= game.game_config.name %>">
        <td><%= game.name %></td>
        <td><%= game.state %></td>
        <td><%= game.players.values.map { |name| name == Game::PENDING_PLAYER ? "-" : name }.join(', ') %></td>
        <td><%= game.sprint %></td>
      </tr>
    <% end %>
    </tbody>
  </table>

  <h3>
    Game Configs
    <%= link_to '+', new_game_config_path, class: "add-object" %>
  </h3>

  <table class="u-full-width">
    <thead>
    <tr>
      <th>Name</th>
      <th>Cards</th>
      <th>Players</th>
      <th></th>
      <th></th>
    </tr>
    </thead>
    <tbody>
    <% @game_configs.each do |game_config| %>
      <%= form_tag games_path(game_config_id: game_config.id) do %>
        <tr data-selector="config-<%= game_config.id %>">
          <td><%= game_config.name %></td>
          <td>
            <% game_config.decks.each do |deckname, cards| %>
              <div>
                <%= "#{deckname}: #{cards.count}" %>
              </div>
            <% end %>
          </td>
          <td><%= select_tag :players, options_for_select((2..4).to_a, 4) %></td>
          <td>
            <%= submit_tag "Start Game" %>
            <br>
            <% if game_config.locked %>
              <%= link_to "Clone", new_game_config_path(parent_id: game_config.id) %>
            <% else %>
              <%= link_to "Edit", edit_game_config_path(game_config) %>
            <% end %>
          </td>
        </tr>
      <% end %>
    <% end %>
    </tbody>
  </table>
</div>
